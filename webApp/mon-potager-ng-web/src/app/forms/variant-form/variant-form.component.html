<form [formGroup]="form" (submit)="submit()">
  <div class="flex flex-row justify-content-between align-items-start">
    <div class="w-9">
      <div fluid>
        <p-iftalabel fluid>
          <input [disabled]="isLoading()" type="text" id="name" pInputText formControlName="name" fluid />
          <label for="name">Nom</label>
        </p-iftalabel>
        @if(form.controls['name'].hasError('required') ) {
        <p-message severity="error" variant="simple" size="small">Le nom est obligatoire</p-message>
        }
      </div>
      <div fluid class="mt-3">
        <p-iftalabel>
          <p-select [disabled]="isLoading()" [options]="families()" formControlName="familyId" optionLabel="name"
            optionValue="id" placeholder="Selectionner une famille" class="w-full md:w-56" />
          <label for="family">Famille</label>
        </p-iftalabel>
        @if(form.controls['familyId'].hasError('required') ) {
        <p-message severity="error" variant="simple" size="small">La famille est obligatoire</p-message>
        }
      </div>
      <div class="mt-2">
        <p-iftalabel>
          <textarea fluid [disabled]="isLoading()" rows="5" pTextarea id="imageSource"
            formControlName="imageSource"></textarea>
          <label for="imageSource">Source de l'image</label>
        </p-iftalabel>
        @if(form.controls['imageSource'].hasError('required') ) {
        <p-message severity="error" variant="simple" size="small">La source de l'image est obligatoire</p-message>
        }
      </div>
    </div>
    @if(isNew){
    <lcdj-loading-image [referenceInitiale]="form.controls['name'].value"
      (referenceModifiee)="referencerImage($event)" />
    }
    @else {
    <lcdj-loading-image [referenceInitiale]="form.controls['image'].value"
      (referenceModifiee)="referencerImage($event)" />
    }
  </div>
  <div class="mt-3 flex flex-row w-full justify-content-center">
    <p-card header="Mois de semis/plantation/réalisation" class="w-full">
      <table>
        <tr>
          <th>J</th>
          <th>F</th>
          <th>M</th>
          <th>A</th>
          <th>M</th>
          <th>J</th>
          <th>J</th>
          <th>A</th>
          <th>S</th>
          <th>O</th>
          <th>N</th>
          <th>D</th>
        </tr>
        <tr>
          <td>
            <p-checkbox formControlName="sowingMonthJanuary" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthFebruary" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthMarch" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthApril" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthMay" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthJune" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthJuly" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthAugust" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthSeptember" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthOctober" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthNovember" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="sowingMonthDecember" [binary]="true" />
          </td>
        </tr>
      </table>
    </p-card>
  </div>
  <div class="mt-3 flex flex-row w-full justify-content-center">
    <p-card header="Mois de récolte" class="w-full">
      <table>
        <tr>
          <th>J</th>
          <th>F</th>
          <th>M</th>
          <th>A</th>
          <th>M</th>
          <th>J</th>
          <th>J</th>
          <th>A</th>
          <th>S</th>
          <th>O</th>
          <th>N</th>
          <th>D</th>
        </tr>
        <tr>
          <td>
            <p-checkbox formControlName="harvestMonthJanuary" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthFebruary" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthMarch" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthApril" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthMay" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthJune" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthJuly" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthAugust" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthSeptember" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthOctober" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthNovember" [binary]="true" />
          </td>
          <td>
            <p-checkbox formControlName="harvestMonthDecember" [binary]="true" />
          </td>
        </tr>
      </table>
    </p-card>
  </div>

  <div class="mt-3 mb-5 flex flex-row justify-content-between">
    <div>
      <p-iftalabel fluid>
        <p-inputnumber fluid [disabled]="isLoading()" id="minDaysBeforeHarvest" suffix=" jours" [min]="7" [max]="300"
          formControlName="minMaturationDaysCount" />
        <label for="minDaysBeforeHarvest">Nombre de jour min de maturation</label>
      </p-iftalabel>
      @if(form.controls['minMaturationDaysCount'].hasError('required') ) {
      <p-message severity="error" variant="simple" size="small">La durée de maturation est obligatoire</p-message>
      }
    </div>
    <div class="ml-2">
      <p-iftalabel fluid>
        <p-inputnumber fluid [disabled]="isLoading()" id="maxDaysBeforeHarvest" suffix=" jours" [min]="7" [max]="300"
          formControlName="maxMaturationDaysCount" />
        <label for="maxDaysBeforeHarvest">Nombre de jour de maturation</label>
      </p-iftalabel>
      @if(form.controls['maxMaturationDaysCount'].hasError('required') ) {
      <p-message severity="error" variant="simple" size="small">La durée de maturation est obligatoire</p-message>
      }
    </div>
  </div>

  <div class="mt-3 flex flex-row justify-content-left">
    <p-button [loading]="isLoading()" [disabled]="!form.dirty || (form.dirty && !form.valid)" type="submit"
      label="Enregistrer" icon="pi pi-check" iconPos="left" [raised]="true" />
  </div>
</form>
